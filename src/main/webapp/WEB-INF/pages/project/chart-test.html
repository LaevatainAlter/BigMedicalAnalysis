<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script src="d3.v4.min.js"></script>
	<style>
		html, body{
			width: 100%;
			height: 100%;
		}
		svg{
			background: lightgrey;
			margin: 0 auto;
		}
	</style>
</head>
<body>
	<div class="storeSvg">
		
	</div>
	<script>
		function getData(){
			var xmlhttp;
			if(window.XMLHttpRequest){
				xmlhttp=new XMLHttpRequest();
			}else{
				xmlhttp=new ActiveXObject('Microsoft.XMLHTTP');
			}
			xmlhttp.onreadystatechange=function(){
				if(xmlhttp.readyState==4 && xmlhttp.status==200){
					var dataset = JSON.parse(xmlhttp.responseText);
					// console.log(xmlhttp.responseText);
					var height = 600;
					var width = 1200;
					var svg = d3.select('.storeSvg')
								.append('svg')
								.attr('width', width)
								.attr('height', height);
					var xScale = d3.scaleLinear()
							.domain([0, dataset.length - 1])
							.range([0, 1150]);
					var xAxis = d3.axisBottom(xScale).ticks(15);
					var gxAxis = svg.append('g')
									.attr('transform', 'translate(30, 580)');
					xAxis(gxAxis);

					var yScale = d3.scaleLinear()
									.domain([150, 30])
									.range([0, 550]);
					var yAxis = d3.axisLeft(yScale).ticks(15);
					var gyAxis = svg.append('g')
									.attr('transform', 'translate(30, 30)');
					yAxis(gyAxis);
					var circle = svg.selectAll('circle')
									.data(dataset)
									.enter()
									.append('circle')
									.attr('fill', 'black')
									.attr('cx', function(d){
										return xScale(d.minute) + 30;
									})
									.attr('cy', function(d){
										return yScale(d.ecgdata) + 30;
									})
									.attr('r', 1);
					// var line = d3.line()
					// 			.x(function(d){
					// 				return xScale(d.minute) + 30;
					// 			})
					// 			.y(function(d){
					// 				return yScale(d.ecgdata) + 30;
					// 			});
					// svg.append('path')
				 //        .attr('class', 'line')
				 //        .attr('d', line(dataset));
			        var line = d3.line()
			        			.x(function(d){
			        				return d.minute + 30;
			        			})
			        			.y(function(d){
			        				return d.ecgdata + 30;
			        			});
					svg.selectAll('path').data(dataset)
							.enter()
							.append('path')
							.attr('d',function(d){
								return line(d)
							})
							.style({
								fill:'none',
								stroke:'#000'
							});
				}
			}
			xmlhttp.open('post', '/toQuery' ,true);
			xmlhttp.send();
		}
		function drawAxis(svg){
			
		}
		getData();
	</script>
</body>
</html>